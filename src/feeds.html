<script type="text/javascript">
	var getElementValues = function($id) {
		var feedVars = {};

		$id.find('input').not(':button').each(function() {
			if ($(this).is(':checkbox')) {
				feedVars[this.name] = testCheckBox(this);
			} else {
				feedVars[this.name] = $(this).val()
			}
		});

		return feedVars;
	}

	
	var fillInElement = function($id, data) {
		$id.find('td.feed-item span').html(
				'<a href="http://' + data.url + '" target="_blank">' + data.url
						+ ' -- Interval: ' + data.interval + '</a>');
		for ( var field in data) {
			if (data[field] === 'TRUE' || data[field] === 'FALSE') {
				if (data[field] === 'TRUE') {
					$id.find('input[name=' + field + ']').prop('checked', true);
				}
			} else {
				$id.find('input[name=' + field + ']').val(data[field]);
			}
		}
		$id.find('input[name=old_url]').val(data.url);
		$id.find('button').each(function() {
			$(this).data('item-id', $id);
		});
		$id.find('input').each(function() {
			$(this).data('item-id', $id);
		});
	}

		var elementCount = 0;
	$(document).ready(function() {
		$('[data-toggle="tooltip"]').tooltip();

		$('#add').click(function() {
			addElement();
		});
		$('#element-list').on('change', ':checkbox[name=enabled]', function() {
			updateElement($(this).data('item-id'));
		});
		$('#element-list').on('click', 'button.edit-button', function() {
			toggleShow($(this).data('item-id'));
		});
		$('#element-list').on('click', 'button.update', function() {
			updateElement($(this).data('item-id'));
			toggleShow($(this).data('item-id'));
		});
		$('#element-list').on('click', 'button.scrape', function() {
			updateElement($(this).data('item-id'));
		});
		$('#element-list').on('click', 'button.delete', function() {
			deleteElement($(this).data('item-id'),$(this).data('item-id').find('input[name=url]').val());
		});
		$('#element-list').on('click', 'button.cancel', function() {
			toggleShow($(this).data('item-id'));
		});

		listElements(true);
	});
</script>
<div class="row">
	<div class="col-sm-8">
		<div class="panel panel-default">
			<div class="panel-body">
				<table id="element-list" class="table table-striped">
					<thead>
						<tr>
							<th style="width: 25px;">Enable</th>
							<th>Feed</th>
							<th style="width: 75px;">Edit</th>
							<th style="width: 75px;">Scrape Now</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="col-sm-4">
		<div class="panel panel-default">
			<div class="panel-heading"><h4 class="panel-title">Add a new feed:</h4></div>
			<div id="new-element-form" class="panel-body">
				<div class="form-group">
					<label for="url">Url:</label> <input type="text" name="url" class="form-control"
						data-toggle="tooltip" data-placement="left" title="The url must be unique.">
				</div>
				<div class="form-group">
					<label for="interval">Interval (min):</label> <input type="number"
						class="form-control" data-toggle="tooltip" data-placement="left"
						name="interval" value="60"
						title="The interval in minutes between RSS feed checks.  Something 60 or over is usually appropriate.">
				</div>
				<div class="checkbox">
					<label><input type="checkbox" name="follow_links" data-toggle="tooltip"
						data-placement="left"
						title="If checked, the link in the RSS item will be followed and the page scraped for links to add to JD">
						Follow Links. </label>
				</div>
				<button type="button" id="add" class="btn btn-primary" data-toggle="popover">Add
					feed</button>
			</div>
		</div>
	</div>
</div>
<table style="display: none;">
	<tr id="element-template" style="display: none;">
		<td><input type="checkbox" name="enabled"></td>
		<td class="feed-item"><span></span>
			<div class="panel panel-default edit" style="display: none;">
				<div class="panel-heading"><h4 class="panel-title">Edit feed:</h4></div>
				<div class="panel-body">
					<div class="form-group">
						<label for="url">Url:</label> <input type="text" name="url"
							class="form-control" value=""> <input type="hidden" name="old_url"
							value="">
					</div>
					<div class="form-group">
						<label for="interval">Interval (min):</label> <input type="number"
							name="interval" class="form-control" value="">
					</div>
					<div class="checkbox">
						<label><input type="checkbox" name="follow_links"> Follow
							Links. </label>
					</div>
					<div class="btn-group" role="group" aria-label="save cancel delete button group">
						<button type="button" class="btn btn-primary update">Update</button>
						<button type="button" class="btn btn-danger delete">Delete</button>
						<button type="button" class="btn btn-info cancel">Cancel</button>
					</div>
				</div>
			</div></td>
		<td>
			<button type="button" class="btn btn-info edit-button" data-placement="top">Edit</button>
		</td>
		<td>
			<button type="button" class="btn btn-primary scrape" data-placement="top">Scrape Now</button>
		</td>
	</tr>
</table>
